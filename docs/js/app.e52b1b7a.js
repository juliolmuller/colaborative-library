(function(e){function t(t){for(var s,r,c=t[0],l=t[1],u=t[2],d=t[3]||[],m=0,h=[];m<c.length;m++)r=c[m],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&h.push(o[r][0]),o[r]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(e[s]=l[s]);p&&p(t),i.push.apply(i,d);while(h.length)h.shift()();return n.push.apply(n,u||[]),a()}function a(){for(var e,t=0;t<n.length;t++){for(var a=n[t],s=!0,r=1;r<a.length;r++){var u=a[r];0!==o[u]&&(s=!1)}s&&(n.splice(t--,1),e=l(l.s=a[0]))}return 0===n.length&&(i.forEach((function(e){if(void 0===o[e]){o[e]=null;var t=document.createElement("link");l.nc&&t.setAttribute("nonce",l.nc),t.rel="prefetch",t.as="script",t.href=c(e),document.head.appendChild(t)}})),i.length=0),e}var s={},r={app:0},o={app:0},n=[],i=[];function c(e){return l.p+"js/"+({}[e]||e)+"."+{"chunk-01d92af5":"186ec519","chunk-17763c44":"dc665ed0","chunk-5a5e1676":"f418d739","chunk-7d848584":"66693694","chunk-9ee37ea0":"bfa7917e"}[e]+".js"}function l(t){if(s[t])return s[t].exports;var a=s[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,l),a.l=!0,a.exports}l.e=function(e){var t=[],a={"chunk-01d92af5":1,"chunk-17763c44":1,"chunk-5a5e1676":1,"chunk-7d848584":1,"chunk-9ee37ea0":1};r[e]?t.push(r[e]):0!==r[e]&&a[e]&&t.push(r[e]=new Promise((function(t,a){for(var s="css/"+({}[e]||e)+"."+{"chunk-01d92af5":"c8ed77f3","chunk-17763c44":"8fd10d77","chunk-5a5e1676":"ca7eef98","chunk-7d848584":"ca7eef98","chunk-9ee37ea0":"aef4760c"}[e]+".css",o=l.p+s,n=document.getElementsByTagName("link"),i=0;i<n.length;i++){var c=n[i],u=c.getAttribute("data-href")||c.getAttribute("href");if("stylesheet"===c.rel&&(u===s||u===o))return t()}var d=document.getElementsByTagName("style");for(i=0;i<d.length;i++){c=d[i],u=c.getAttribute("data-href");if(u===s||u===o)return t()}var m=document.createElement("link");m.rel="stylesheet",m.type="text/css",m.onload=t,m.onerror=function(t){var s=t&&t.target&&t.target.src||o,n=new Error("Loading CSS chunk "+e+" failed.\n("+s+")");n.code="CSS_CHUNK_LOAD_FAILED",n.request=s,delete r[e],m.parentNode.removeChild(m),a(n)},m.href=o;var p=document.getElementsByTagName("head")[0];p.appendChild(m)})).then((function(){r[e]=0})));var s=o[e];if(0!==s)if(s)t.push(s[2]);else{var n=new Promise((function(t,a){s=o[e]=[t,a]}));t.push(s[2]=n);var i,u=document.createElement("script");u.charset="utf-8",u.timeout=120,l.nc&&u.setAttribute("nonce",l.nc),u.src=c(e);var d=new Error;i=function(t){u.onerror=u.onload=null,clearTimeout(m);var a=o[e];if(0!==a){if(a){var s=t&&("load"===t.type?"missing":t.type),r=t&&t.target&&t.target.src;d.message="Loading chunk "+e+" failed.\n("+s+": "+r+")",d.name="ChunkLoadError",d.type=s,d.request=r,a[1](d)}o[e]=void 0}};var m=setTimeout((function(){i({type:"timeout",target:u})}),12e4);u.onerror=u.onload=i,document.head.appendChild(u)}return Promise.all(t)},l.m=e,l.c=s,l.d=function(e,t,a){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},l.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(l.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)l.d(a,s,function(t){return e[t]}.bind(null,s));return a},l.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="/",l.oe=function(e){throw console.error(e),e};var u=window["webpackJsonp"]=window["webpackJsonp"]||[],d=u.push.bind(u);u.push=t,u=u.slice();for(var m=0;m<u.length;m++)t(u[m]);var p=d,h=function(){return n.push([0,"chunk-vendors"]),a()}();t([[],{},0,["chunk-7d848584","chunk-17763c44","chunk-9ee37ea0","chunk-5a5e1676","chunk-01d92af5"]])})({0:function(e,t,a){e.exports=a("56d7")},2241:function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},r=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{staticClass:"h1",attrs:{id:"logo"}},[e._v(" Estante"),a("span",{staticClass:"badge badge-hero p-1"},[e._v("Virtual")])])}],o={name:"Logo"},n=o,i=(a("c4ed"),a("2877")),c=Object(i["a"])(n,s,r,!1,null,null,null);t["a"]=c.exports},2267:function(e,t,a){},"56d7":function(e,t,a){"use strict";a.r(t);a("a79d");var s=a("2b0e"),r=a("8c4f"),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"auth"}},[a("div",{staticClass:"auth-container"},[a("header",{staticClass:"auth-header"},[a("Logo")],1),a("RouterView"),a("footer",{staticClass:"auth-footer text-muted"},[e._v(" © 2019-"+e._s((new Date).getFullYear())+" "),a("strong",[e._v("LacusSoft")])])],1)])},n=[],i=a("2241"),c={components:{Logo:i["a"]}},l=c,u=(a("ef9f"),a("2877")),d=Object(u["a"])(l,o,n,!1,null,null,null),m=d.exports,p=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("form",{attrs:{id:"sign-in"},on:{submit:function(t){return t.preventDefault(),e.handleSubmit(t)}}},[a("div",{staticClass:"alert alert-danger border-danger",style:{visibility:e.errors.length?"visible":"hidden"},attrs:{role:"alert"}},e._l(e.errors,(function(t,s){return a("p",{key:s,staticClass:"text-danger"},[e._v(" "+e._s(t)+" ")])})),0),a("label",{staticClass:"sr-only",attrs:{for:"email"}},[e._v(" Endereço de email ")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.email,expression:"email"}],staticClass:"form-control",attrs:{id:"email",type:"email",placeholder:"Endereço de email",required:"",autofocus:""},domProps:{value:e.email},on:{input:function(t){t.target.composing||(e.email=t.target.value)}}}),a("label",{staticClass:"sr-only",attrs:{for:"password"}},[e._v(" Senha de acesso ")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],staticClass:"form-control",attrs:{id:"password",type:"password",placeholder:"Senha de acesso",required:""},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}}),a("label",{staticClass:"mt-2 checkbox"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.keepConnection,expression:"keepConnection"}],attrs:{type:"checkbox",value:"remember-me"},domProps:{checked:Array.isArray(e.keepConnection)?e._i(e.keepConnection,"remember-me")>-1:e.keepConnection},on:{change:function(t){var a=e.keepConnection,s=t.target,r=!!s.checked;if(Array.isArray(a)){var o="remember-me",n=e._i(a,o);s.checked?n<0&&(e.keepConnection=a.concat([o])):n>-1&&(e.keepConnection=a.slice(0,n).concat(a.slice(n+1)))}else e.keepConnection=r}}}),e._v(" Mantenha-me conectado ")]),a("button",{staticClass:"mt-3 btn btn-lg btn-hero btn-block",attrs:{type:"submit",disabled:e.isLoading}},[e._v("Entrar")]),a("p",{staticClass:"mt-1 text-center"},[e._v(" Não é cadastrado? "),a("RouterLink",{staticClass:"text-hero",attrs:{to:{name:"SignUp"}}},[e._v(" Registre-se aqui ")])],1)])},h=[],f=a("2f62"),g={data:()=>({email:"",password:"",keepConnection:!1,errors:[],isLoading:!1}),watch:{email(e){this.email=e.toLowerCase()}},methods:{...Object(f["b"])("auth",["authenticate"]),async handleSubmit(){this.isLoading=!0;try{const e=await this.authenticate({keepConnection:this.keepConnection,password:this.password,email:this.email});if(e)return void this.$router.push({name:"Home"});this.errors=["Email e senha não conferem"],this.isLoading=!1,this.password=""}catch(e){console.error(e),this.isLoading=!1,this.errors=[e.message]}}}},v=g,b=(a("b6b3"),Object(u["a"])(v,p,h,!1,null,null,null)),w=b.exports,k=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("form",{attrs:{id:"sign-up"},on:{submit:function(t){return t.preventDefault(),e.handleSubmit(t)}}},[a("div",{staticClass:"alert alert-danger border-danger",style:{visibility:e.errors.length?"visible":"hidden"},attrs:{role:"alert"}},e._l(e.errors,(function(t,s){return a("p",{key:s,staticClass:"text-danger"},[e._v(" "+e._s(t)+" ")])})),0),a("label",{staticClass:"sr-only",attrs:{for:"name"}},[e._v(" Nome do usuário ")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"name"}],staticClass:"form-control",attrs:{id:"name",type:"text",placeholder:"Nome do usuário",required:"",autofocus:""},domProps:{value:e.name},on:{input:function(t){t.target.composing||(e.name=t.target.value)}}}),a("label",{staticClass:"sr-only",attrs:{for:"email"}},[e._v(" Endereço de email ")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.email,expression:"email"}],staticClass:"form-control",attrs:{id:"email",type:"email",placeholder:"Endereço de email",required:""},domProps:{value:e.email},on:{input:function(t){t.target.composing||(e.email=t.target.value)}}}),a("label",{staticClass:"sr-only",attrs:{for:"password"}},[e._v(" Senha de acesso ")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],staticClass:"form-control",attrs:{id:"password",type:"password",placeholder:"Senha de acesso",required:""},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}}),a("label",{staticClass:"sr-only",attrs:{for:"password-confirmation"}},[e._v(" Confirmação da senha ")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.passwordConfirmation,expression:"passwordConfirmation"}],staticClass:"form-control",attrs:{id:"password-confirmation",type:"password",placeholder:"Confirmação da senha",required:""},domProps:{value:e.passwordConfirmation},on:{input:function(t){t.target.composing||(e.passwordConfirmation=t.target.value)}}}),a("button",{staticClass:"btn btn-lg btn-hero",attrs:{type:"submit",disabled:e.isLoading}},[e._v("Cadastrar")]),a("p",{staticClass:"mt-1 text-center"},[a("RouterLink",{staticClass:"text-hero",attrs:{to:{name:"SignIn"}}},[e._v(" Já sou cadastrado ")])],1)])},y=[],C=(a("ddb0"),a("b383")),_=a.n(C),S=a("bc3a"),x=a.n(S);class L{constructor(e){this.http=x.a.create({baseURL:"https://collaborative-library.herokuapp.com/"+e})}async get(e){const t=e?_.a.stringify(e):"",a=await this.http.get("/?_limit=100&"+t);return a.data}async getOne(e){const t=await this.http.get("/"+e);return t.data}async post(e){const t=await this.http.post("/",e);return t.data}async put(e){const t=await this.http.put("/"+e.id,e);return t.data}async delete(e){const t=await this.http.delete("/"+e);return t.data}}var O=L;const E=new O("books"),F=new O("users");var D={data:()=>({name:"",email:"",password:"",passwordConfirmation:"",errors:[],isLoading:!1}),watch:{email(e){this.email=e.toLowerCase()}},methods:{...Object(f["b"])("auth",["authenticate"]),async handleSubmit(){this.isLoading=!0;const[e]=await F.get({email:this.email}),t=this.password===this.passwordConfirmation;if(e||!t)return this.passwordConfirmation="",this.password="",this.errors=[],e&&this.errors.push("Email já está cadastrado"),!t&&this.errors.push("As senhas não são iguais"),void(this.isLoading=!1);try{const e=await F.post({password:this.password,email:this.email,name:this.name});await this.authenticate(e),this.$router.push({name:"Home"})}catch(a){console.error(a),this.isLoading=!1,this.errors=[a.message]}}}},B=D,P=Object(u["a"])(B,k,y,!1,null,null,null),A=P.exports;const j="user-data";var I={namespaced:"auth",state:{userData:null},getters:{isAuthenticated:e=>Boolean(e.userData),userData:e=>{var t,a,s;return{email:null===(t=e.userData)||void 0===t?void 0:t.email,name:null===(a=e.userData)||void 0===a?void 0:a.name,id:null===(s=e.userData)||void 0===s?void 0:s.id}}},mutations:{setUserData(e,t=null){e.userData=t},setBrowserStorage(e,t){if(e.userData){const a=JSON.stringify(e.userData);t.setItem(j,a)}else sessionStorage.removeItem(j),localStorage.removeItem(j)}},actions:{async authenticate({commit:e},{email:t,password:a,keepConnection:s}){const[r]=await F.get({email:t,password:a}),o=s?localStorage:sessionStorage;return!!r&&(e("setUserData",r),e("setBrowserStorage",o),!0)},retrieveFromStorage(){const e=localStorage.getItem(j),t=sessionStorage.getItem(j),a=JSON.parse(e||t),s=e?localStorage:sessionStorage;return{userData:a,storage:s}},signOut({commit:e}){e("setUserData"),e("setBrowserStorage")},async update({dispatch:e},{id:t,name:a,email:s,oldPassword:r,newPassword:o}){const{storage:n}=await e("retrieveFromStorage"),i=n===localStorage,c=await F.getOne(t),l=r===c.password?o||r:c.password,u=await F.put({id:t,name:a,email:s,password:l});await e("authenticate",{...u,keepConnection:i})}}},N={namespaced:"books",state:{isFetching:!1,books:[]},getters:{isFetching:e=>e.isFetching,allBooks:e=>e.books,availableBooks:e=>e.books.filter(e=>!e.loan),borrowedBooks:e=>e.books.filter(e=>e.loan),userBooks(e,t,a,s){var r;const o=null===(r=s["auth/userData"])||void 0===r?void 0:r.id;return e.books.filter(e=>e.userId===o)},userLoans(e,t,a,s){var r;const o=null===(r=s["auth/userData"])||void 0===r?void 0:r.id;return e.books.filter(e=>{var t;return(null===(t=e.loan)||void 0===t?void 0:t.userId)===o})}},mutations:{setFetching(e,t){e.isFetching=t},toggleFetching(e){e.isFetching=!e.isFetching},setBooks(e,t){e.books=t},removeBook(e,t){e.books=e.books.filter(({id:e})=>t!==e)},updateOrPushBook(e,t){let a=!1;const s=e.books.map(e=>e.id===t.id?(a=!0,t):e);e.books=a?s:[...e.books,t]}},actions:{async fetchAll({commit:e}){e("setFetching",!0),e("setBooks",await E.get()),e("setFetching",!1)},async create({commit:e,rootGetters:t},{name:a,image:s}){const r=!1,o=t["auth/userData"].id,n=await E.post({name:a,image:s,userId:o,loan:r});return e("updateOrPushBook",n),n},async update({commit:e},{id:t,name:a,image:s,userId:r,loan:o}){const n=await E.put({id:t,name:a,image:s,userId:r,loan:o});e("updateOrPushBook",n)},async borrow({dispatch:e,rootGetters:t},{id:a}){const s=t["books/allBooks"].find(e=>e.id===a),r=(new Date).toISOString().slice(0,10),o=t["auth/userData"].id,n={date:r,userId:o};await e("update",{...s,loan:n})},async return({dispatch:e,rootGetters:t},{id:a}){const s=t["books/allBooks"].find(e=>e.id===a),r=!1;await e("update",{...s,loan:r})},async delete({commit:e},{id:t}){await E.delete(t),e("removeBook",t)}}},U={namespaced:"users",state:{isFetching:!1,users:[]},getters:{isFetching:e=>e.isFetching,allUsers:e=>e.users,userById(e){return t=>{const a=e.users.find(e=>e.id===Number(t));return a&&{id:a.id,name:a.name,email:a.email}}}},mutations:{setFetching(e,t){e.isFetching=t},toggleFetching(e){e.isFetching=!e.isFetching},setUsers(e,t){e.users=t}},actions:{async fetchAll({commit:e}){e("setFetching",!0),e("setUsers",await F.get()),e("setFetching",!1)}}};s["a"].use(f["a"]);const $=new f["a"].Store({getters:{isLoading(e,t){return t["books/isFetching"]||t["users/isFetching"]}},modules:{auth:I,books:N,users:U}});var q=$;const T=()=>a.e("chunk-01d92af5").then(a.bind(null,"16c0")),M=()=>a.e("chunk-17763c44").then(a.bind(null,"9261")),R=()=>a.e("chunk-7d848584").then(a.bind(null,"02b3")),J=()=>a.e("chunk-9ee37ea0").then(a.bind(null,"069c")),H=()=>a.e("chunk-5a5e1676").then(a.bind(null,"9db2"));s["a"].use(r["a"]);const G=(e,t,a)=>{(async()=>{if(!q.getters["auth/isAuthenticated"]){const{userData:e,storage:t}=await q.dispatch("auth/retrieveFromStorage");q.commit("auth/setUserData",e),q.commit("auth/setBrowserStorage",t)}q.getters["auth/isAuthenticated"]?a():a({name:"SignIn"})})()},V=[{path:"/entrar",component:m,children:[{path:"/entrar",name:"SignIn",component:w},{path:"/cadastrar",name:"SignUp",component:A}]},{path:"/",component:T,beforeEnter:G,children:[{path:"/",name:"Home",component:M},{path:"/livros/:bookId",name:"BookDetails",component:R,props:!0},{path:"/meus-livros",name:"UserBooks",component:J,props:{title:"Meus Livros",type:"userBooks"}},{path:"/meus-emprestimos",name:"UserLoans",component:J,props:{title:"Meus Empréstimos",type:"userLoans"}},{path:"/meu-perfil",name:"UserProfile",component:H}]},{path:"*",redirect:"/"}],K=new r["a"]({mode:"hash",routes:V});var Y=K,z=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("RouterView")],1)},Q=[],W={name:"App",beforeCreate(){this.$store.dispatch("users/fetchAll"),this.$store.dispatch("books/fetchAll")}},X=W,Z=(a("5c0b"),Object(u["a"])(X,z,Q,!1,null,null,null)),ee=Z.exports;s["a"].config.productionTip=!1,new s["a"]({router:Y,store:q,render:e=>e(ee)}).$mount("#app")},"5c0b":function(e,t,a){"use strict";a("9c0c")},6860:function(e,t,a){},"9c0c":function(e,t,a){},"9cc8":function(e,t,a){},b6b3:function(e,t,a){"use strict";a("6860")},c4ed:function(e,t,a){"use strict";a("9cc8")},ef9f:function(e,t,a){"use strict";a("2267")}});
//# sourceMappingURL=app.e52b1b7a.js.map